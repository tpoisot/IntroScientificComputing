<!DOCTYPE html>
<html><head>
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous">
  <link rel="stylesheet" href='//cdn.jsdelivr.net/npm/hack-font@3.3.0/build/web/hack.css'>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.0.0/mermaid.js"></script>

  <link rel="stylesheet" href="/css/normalize.css" />
  <link rel="stylesheet" href="/css/configuration.css" />
  <link rel="stylesheet" href="/css/index.css" />

  <meta charset="utf-8">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/katex.min.css" integrity="sha384-D+9gmBxUQogRLqvARvNLmA9hS2x//eK1FhVb9PiU86gmcrBrJAQT8okdJ4LMp2uv" crossorigin="anonymous">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/katex.min.js" integrity="sha384-483A6DwYfKeDa0Q52fJmxFXkcPCFfnXMoXblOkJ4JcA8zATN6Tm78UNL72AKk+0O" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/contrib/auto-render.min.js" integrity="sha384-yACMu8JWxKzSp/C1YV86pzGiQ/l1YUfE8oPuahJQxzehAjEt2GiQuy/BIvl9KyeF" crossorigin="anonymous"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      renderMathInElement(document.body, {
        delimiters: [
        {left: "$$", right: "$$", display: true},
        {left: "$", right: "$", display: false}
        ]
      });
    });
  </script>

  <title>Avoiding mistakes · Scientific computing</title>

</head>
<body><nav id="main" class="sidebar">
  <div class="toggle">
    <a class="button">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
        <line x1="0" y1="20" x2="100" y2="20" />
        <line x1="0" y1="50" x2="100" y2="50" />
        <line x1="0" y1="80" x2="100" y2="80" />
      </svg>
    </a>
  </div>
  <div class="header">
    <h1><a href="/">Scientific computing</a></h1>
    <h2>(for the rest of us)</h2>
  </div>
  <ul class="nav">
    
    
    <li class="lessons"><i class="fas fa-fw fa-graduation-cap"></i><a class="sidebar-nav-item  active" href="/lessons/" title="">Lessons</a></li>
    
    <li class="primers"><i class="fas fa-fw fa-bolt"></i><a class="sidebar-nav-item " href="/primers/" title="">Primers</a></li>
    
    <li class="capstones"><i class="fas fa-fw fa-star"></i><a class="sidebar-nav-item " href="/capstones/" title="">Capstones</a></li>
    
    <li class="ml"><i class="fas fa-fw fa-brain"></i><a class="sidebar-nav-item " href="/machinelearning/" title="">Machine Learning</a></li>
    
  </ul>
</nav>
<section id="content">



<h2 id="we-can-t-avoid-mistakes">We can&rsquo;t avoid mistakes</h2>

<p>But we can work as cautiously as possible, to make sure we catch them in time.
It is always better to try and fail to run something, than to have the operation
keep going and accumulating mistakes.</p>

<p>There are four types of mistakes to look out for: mistakes in the code,
confusing interface, issues with arguments, and lack of integration. Some are
caused by the programmer, and some are caused by the user. But in the context of
writing code for science, the programmer and the user are often the same person,
and so passing the blame around ends up being a very frustrating exercise. Even
if it were not the case, user mistakes can come from sub-optimal design. It is
crucial to work in a way that protects everyone against mistakes.</p>

<div class="callout opinion">One of our golden rules is &ldquo;fail early, fail often, and
fail explicitely&rdquo; &ndash; it is frustrating to have to restart an analysis, but this
is preferable to running an analysis that keeps accumulating issues we may or
may not detect!</div>


<p>In this lesson, you may note that we will switch perspective frequently, from
user to developper. This is because, in our own experience, this is a fair
representation of the way we work. We try to write something (developper), then
apply it to a specific problem (user), then figure out there is an issue and
switch back to developper mode.</p>

<h2 id="after-this-lesson-you-will-be-able-to">After this lesson, you will be able to &hellip;</h2>

<ul>
<li>&hellip; use defensive programming</li>
<li>&hellip; write basic tests to ensure that the program fails when it should</li>
<li>&hellip; think about function design in a way that minimizes confusion</li>
</ul>

<p>But let&rsquo;s do something a little bit different. Instead of writing a function, we
will start by thinking about its behavior. In this example, we want to write a
function that will calculate an average. That&rsquo;s it. Specifically, it will
calculate the singal-to-noise ration in an array of numbers, using the S = μ/σ
expression, where μ is the average and σ the standard deviation.</p>

<p>What we will do is <em>declare</em> the function, but put nothing in it &ndash; in each of
the sections, we will add a few lines to the function, to make it <em>work</em>. For
now, we want a function that does <em>nothing</em>.</p>
<div class="highlight"><pre class="chroma"><code class="language-julia" data-lang="julia"><span class="k">function</span> <span class="n">snr</span><span class="p">(</span><span class="n">x</span><span class="o">::</span><span class="kt">Vector</span><span class="p">{</span><span class="n">T</span><span class="p">})</span> <span class="n">where</span> <span class="p">{</span><span class="n">T</span> <span class="o">&lt;:</span> <span class="kt">Number</span><span class="p">}</span>
<span class="k">end</span></code></pre></div>
<pre><code>snr (generic function with 1 method)
</code></pre>

<h2 id="using-the-wrong-arguments">Using the wrong arguments</h2>

<p>The first thing that can go wrong with this function is calling it with the
wrong arguments. In a sense, we have limited this risk because we took advantage
of Julia&rsquo;s type annotation system, and so we can <em>only</em> call our function when
the argument is an array of numbers.</p>

<p>But with the definition of signal-to-noise ratio we picked, it only makes sense
to apply this function when all elements of <code>x</code> are <em>non-negative</em>. So this is
the first thing our function should check. But instead of changing the function,
we will first <em>test</em> its behavior.</p>

<div class="callout information">This process, starting by the tests and writing the function after, is called
<em>test-driven development</em>. It is not the only way to proceed, but we think it is
an interesting practice to experiment with.</div>


<p>Let&rsquo;s start by documenting our &ldquo;normal&rdquo; behavior: calling the function with only
positive or null numbers should not give any warning or error message:</p>
<div class="highlight"><pre class="chroma"><code class="language-julia" data-lang="julia"><span class="k">using</span> <span class="n">Test</span>
<span class="nd">@test_nowarn</span> <span class="n">snr</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">])</span></code></pre></div>
<p>This test is <em>passing</em>: running the function with this argument gives no warning
(because the function currently does nothing, but that is besides the point).
And we also want our function to return an error when we call it with negative
arguments:</p>
<div class="highlight"><pre class="chroma"><code class="language-julia" data-lang="julia"><span class="nd">@test_throws</span> <span class="kt">DomainError</span> <span class="n">snr</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">])</span></code></pre></div>
<pre><code>Test Failed at none:1
  Expression: snr([-1.0, 1.0, 2.0])
    Expected: DomainError
  No exception thrown
</code></pre>

<pre class="julia-error">
ERROR: Test.FallbackTestSetException&#40;&quot;There was an error during testing&quot;&#41;
</pre>

<p>Well, this one, predictabily, is failing! So here is our first step: we need to
add something to our function to make it return a <code>DomainError</code> &ndash; this is a
way to tell our user that something is not quite right with the arguments.</p>

<div class="callout information">Julia, like most modern languages, has a well developed system for throwing
errors, and when you write code that becomes a little bit complex, or is meant
to be used by others, it is worth spending some time reading it.</div>


<p>We can add a line checking the sign of the smallest value of <code>x</code> &ndash; if this is
lower than 0 (and specifically, of the <code>zero</code> value of the type <code>T</code> of the
elements), then we <em>throw</em> an error.</p>
<div class="highlight"><pre class="chroma"><code class="language-julia" data-lang="julia"><span class="k">function</span> <span class="n">snr</span><span class="p">(</span><span class="n">x</span><span class="o">::</span><span class="kt">Vector</span><span class="p">{</span><span class="n">T</span><span class="p">})</span> <span class="n">where</span> <span class="p">{</span><span class="n">T</span> <span class="o">&lt;:</span> <span class="kt">Number</span><span class="p">}</span>
  <span class="n">minimum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">.&lt;</span> <span class="n">zero</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">throw</span><span class="p">(</span><span class="kt">DomainError</span><span class="p">(</span><span class="n">minimum</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s">&#34;all values passed must be positive or null.&#34;</span><span class="p">))</span>
<span class="k">end</span></code></pre></div>
<pre><code>snr (generic function with 1 method)
</code></pre>

<p>Note that our error is <em>informative</em>: it gives a message explaining what went
wrong. Now that we have added this line, we need to make sure that <em>both</em> our
tests pass!</p>
<div class="highlight"><pre class="chroma"><code class="language-julia" data-lang="julia"><span class="nd">@test_nowarn</span> <span class="n">snr</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">])</span>
<span class="nd">@test_throws</span> <span class="kt">DomainError</span> <span class="n">snr</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">])</span></code></pre></div>
<pre><code>Test Passed
      Thrown: DomainError
</code></pre>

<p>Yeah! Now, because our function involves calculating a standard deviation, we
may want to restrict its application to inputs with more than 3 elements. This
is also something we can test, and throw an error:</p>
<div class="highlight"><pre class="chroma"><code class="language-julia" data-lang="julia"><span class="k">function</span> <span class="n">snr</span><span class="p">(</span><span class="n">x</span><span class="o">::</span><span class="kt">Vector</span><span class="p">{</span><span class="n">T</span><span class="p">})</span> <span class="n">where</span> <span class="p">{</span><span class="n">T</span> <span class="o">&lt;:</span> <span class="kt">Number</span><span class="p">}</span>
  <span class="n">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="n">throw</span><span class="p">(</span><span class="kt">ArgumentError</span><span class="p">(</span><span class="s">&#34;A minimum of three values must be provided.&#34;</span><span class="p">))</span>
  <span class="n">minimum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">.&lt;</span> <span class="n">zero</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">throw</span><span class="p">(</span><span class="kt">DomainError</span><span class="p">(</span><span class="n">minimum</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s">&#34;all values passed must be positive or null.&#34;</span><span class="p">))</span>
<span class="k">end</span></code></pre></div>
<pre><code>snr (generic function with 1 method)
</code></pre>

<p>And now, let&rsquo;s run <em>all of the previous tests</em>, but also a new one.</p>
<div class="highlight"><pre class="chroma"><code class="language-julia" data-lang="julia"><span class="nd">@test_nowarn</span> <span class="n">snr</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">])</span>
<span class="nd">@test_throws</span> <span class="kt">DomainError</span> <span class="n">snr</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">])</span>
<span class="nd">@test_throws</span> <span class="kt">ArgumentError</span> <span class="n">snr</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span></code></pre></div>
<pre><code>Test Passed
      Thrown: ArgumentError
</code></pre>

<p>At this point, our function still does nothing. In fact, it does <em>less</em> than
nothing, since it will refuse to run in some situations. This practice is
generally refered to as <em>defensive programming</em>: we want to perform the actual
computation only when we are confident that the conditions to run it are met.</p>

<p>For now, we have done enough work. Let&rsquo;s work on the code later, and we will
instead improve the &ldquo;interface&rdquo; of our function.</p>

<h2 id="confusing-interface">Confusing interface</h2>

<div class="callout opinion">This entire section is a matter of opinions &ndash; we encourage you to have a look
at your favorite language&rsquo;s manual of style. <a href="https://docs.julialang.org/en/v1/manual/style-guide/index.html">Julia has
one</a> which we
think is good, and we generally follow, except when we don&rsquo;t.</div>


<p>As it is written, our function does not have a particularly explicit name. Maybe
<code>snr</code> makes sense to us because it is fresh in our mind; but will it still be
true in a week? A month? Let&rsquo;s instead aim for something more explicit:
<code>signaltonoiseratio</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-julia" data-lang="julia"><span class="k">function</span> <span class="n">signaltonoiseratio</span><span class="p">(</span><span class="n">x</span><span class="o">::</span><span class="kt">Vector</span><span class="p">{</span><span class="n">T</span><span class="p">})</span> <span class="n">where</span> <span class="p">{</span><span class="n">T</span> <span class="o">&lt;:</span> <span class="kt">Number</span><span class="p">}</span>
  <span class="n">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="n">throw</span><span class="p">(</span><span class="kt">ArgumentError</span><span class="p">(</span><span class="s">&#34;A minimum of three values must be provided.&#34;</span><span class="p">))</span>
  <span class="n">minimum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">.&lt;</span> <span class="n">zero</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">throw</span><span class="p">(</span><span class="kt">DomainError</span><span class="p">(</span><span class="n">minimum</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s">&#34;all values passed must be positive or null.&#34;</span><span class="p">))</span>
<span class="k">end</span></code></pre></div>
<pre><code>signaltonoiseratio (generic function with 1 method)
</code></pre>

<p>It is longer, but it is also more explicit. And in most cases, typing <code>sign</code> and
pressing <code>Tab</code> will autocomplete to the full function name, so there is minimal
effort involved.</p>

<p>Another source of mistakes is to have non-descriptive names for variables. In
the existing function, the most important variable is called <code>x</code>: this means
nothing. We will replace <code>x</code> by something more informative, such as
<code>measurement</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-julia" data-lang="julia"><span class="k">function</span> <span class="n">signaltonoiseratio</span><span class="p">(</span><span class="n">measurement</span><span class="o">::</span><span class="kt">Vector</span><span class="p">{</span><span class="n">T</span><span class="p">})</span> <span class="n">where</span> <span class="p">{</span><span class="n">T</span> <span class="o">&lt;:</span> <span class="kt">Number</span><span class="p">}</span>
  <span class="n">length</span><span class="p">(</span><span class="n">measurement</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="n">throw</span><span class="p">(</span><span class="kt">ArgumentError</span><span class="p">(</span><span class="s">&#34;A minimum of three values must be provided.&#34;</span><span class="p">))</span>
  <span class="n">minimum</span><span class="p">(</span><span class="n">measurement</span><span class="p">)</span> <span class="o">.&lt;</span> <span class="n">zero</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">throw</span><span class="p">(</span><span class="kt">DomainError</span><span class="p">(</span><span class="n">minimum</span><span class="p">(</span><span class="n">measurement</span><span class="p">),</span> <span class="s">&#34;all values passed must be positive or null.&#34;</span><span class="p">))</span>
<span class="k">end</span></code></pre></div>
<pre><code>signaltonoiseratio (generic function with 1 method)
</code></pre>

<p>At this point, our function still does <em>absolutely nothing</em>, but we can be sure
that it is named in a way that makes it easier to reason about, will refuse to
run when the arguments are wrong, and uses variable names that mean something.
In short, it does nothing, but it does it really well.</p>

<h2 id="mistakes-in-the-code">Mistakes in the code</h2>

<h2 id="lack-of-integration">Lack of integration</h2>

<ul>
<li>mistake in functions</li>
<li>integration issues</li>
</ul>



      </section><script src="/js/ui.js"></script>
<script>mermaid.initialize({startOnLoad:true, theme:"neutral", curve: "basis"});</script>
</body>
</html>
